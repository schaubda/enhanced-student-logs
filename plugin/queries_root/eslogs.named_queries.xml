<?xml version="1.0" encoding="UTF-8"?>
<queries>
    <query name="com.powerschool.eslogs.log_entries.list" flattened="true">
        <summary>Enhanced Student Logs - Entries List</summary>
        <description>
            Lists all log entries for a given student DCID
        </description>
        <args>
            <arg name="studentDCID" column="students.dcid" required="false" default=""/>
        </args>
        <columns>
            <column column="log.dcid">log_entries.dcid</column>
            <column column="log.entry_date">log_entries.entry_date</column>
            <column column="log.entry_author">log_entries.entry_author</column>
            <column column="log.entry_author">log_entries.entry_time</column>
            <column column="gen.name">log_entries.logtype</column>
            <column column="gen.valuet">log_entries.subtype</column>
            <column column="schools.name">log_entries.school</column>
            <column column="users.lastfirst">log_entries.teacher</column>
            <column column="students.lastfirst">log_entries.student</column>
            <column column="log.subject">log_entries.subject</column>
            <column column="log.entry">log_entries.entry</column>
            <column column="log.category">log_entries.category</column>
            <column column="log.consequence">log_entries.consequence</column>
            <column column="log.custom">log_entries.custom</column>
            <column column="log.discipline_actiondate">
                log_entries.discipline_actiondate
            </column>
            <column column="log.discipline_actiontaken">
                log_entries.discipline_actiontaken
            </column>
            <column column="log.discipline_actiontakendetail">
                log_entries. discipline_actiontakendetail
            </column>
            <column column="log.discipline_administratorid">
                log_entries.discipline_administratorid
            </column>
            <column column="log.discipline_alcoholrelatedflag">
                log_entries. discipline_alcoholrelatedflag
            </column>
            <column column="log.discipline_drugrelatedflag">
                log_entries.discipline_drugrelatedflag
            </column>
            <column column="log.discipline_drugtypedetail">
                log_entries.discipline_drugtypedetail
            </column>
            <column column="log.discipline_durationactual">
                log_entries.discipline_durationactual
            </column>
            <column column="log.discipline_durationassigned">
                log_entries. discipline_durationassigned
            </column>
            <column column="log.discipline_durationnotes">
                log_entries.discipline_durationnotes
            </column>
            <column column="log.discipline_felonyflag">
                log_entries.discipline_felonyflag
            </column>
            <column column="log.discipline_gangrelatedflag">
                log_entries.discipline_gangrelatedflag
            </column>
            <column column="log.discipline_hatecrimeflag">
                log_entries.discipline_hatecrimeflag
            </column>
            <column column="log.discipline_hearingofficerflag">
                log_entries. discipline_hearingofficerflag
            </column>
            <column column="log.discipline_incidentcontext">
                log_entries.discipline_incidentcontext
            </column>
            <column column="log.discipline_incidentdate">
                log_entries.discipline_incidentdate
            </column>
            <column column="log.discipline_incidentlocdetail">
                log_entries. discipline_incidentlocdetail
            </column>
            <column column="log.discipline_incidenttype">
                log_entries.discipline_incidenttype
            </column>
            <column column="log.discipline_incidenttypedetail">
                log_entries. discipline_incidenttypedetail
            </column>
            <column column="log.discipline_likelyinjuryflag">
                log_entries. discipline_likelyinjuryflag
            </column>
            <column column="log.discipline_moneylossvalue">
                log_entries.discipline_moneylossvalue
            </column>
            <column column="log.discipline_offender">
                log_entries.discipline_offender
            </column>
            <column column="log.discipline_policeinvolvedflag">
                log_entries. discipline_policeinvolvedflag
            </column>
            <column column="log.discipline_reporter">
                log_entries.discipline_reporter
            </column>
            <column column="log.discipline_reporterid">
                log_entries.discipline_reporterid
            </column>
            <column column="log.discipline_schoolrulesvioflag">
                log_entries. discipline_schoolrulesvioflag
            </column>
            <column column="log.discipline_sequence">
                log_entries.discipline_sequence
            </column>
            <column column="log.discipline_victimtype">
                log_entries.discipline_victimtype
            </column>
            <column column="log.discipline_weaponrelatedflag">
                log_entries.discipline_weaponrelatedflag
            </column>
            <column column="log.discipline_weapontype">
                log_entries.discipline_weapontype
            </column>
            <column column="log.discipline_weapontypenotes">
                log_entries.discipline_weapontypenotes
            </column>
            <column column="log.incidenttypecategory">
                log_entries.incidenttypecategory
            </column>
        </columns>
        <sql>
            <![CDATA[
            SELECT
                l.dcid,
                l.entry_date,
                l.entry_author,
                to_char(to_date
                        (l.entry_time,
                         'SSSSS'),
                        'hh:mi PM') entry_time,
                lt.name             logtype,
                st.valuet           subtype,
                sch.name            school,
                tch.lastfirst       teacher,
                stu.lastfirst       student,
                l.subject,
                l.entry,
                l.category,
                l.consequence,
                l.custom,
                l.discipline_actiondate,
                l.discipline_actiontaken,
                l.discipline_actiontakendetail,
                l.discipline_administratorid,
                l.discipline_alcoholrelatedflag,
                l.discipline_drugrelatedflag,
                l.discipline_drugtypedetail,
                l.discipline_durationactual,
                l.discipline_durationassigned,
                l.discipline_durationnotes,
                l.discipline_felonyflag,
                l.discipline_gangrelatedflag,
                l.discipline_hatecrimeflag,
                l.discipline_hearingofficerflag,
                l.discipline_incidentcontext,
                l.discipline_incidentdate,
                l.discipline_incidentlocdetail,
                l.discipline_incidenttype,
                l.discipline_incidenttypedetail,
                l.discipline_likelyinjuryflag,
                l.discipline_moneylossvalue,
                l.discipline_offender,
                l.discipline_policeinvolvedflag,
                l.discipline_reporter,
                l.discipline_reporterid,
                l.discipline_schoolrulesvioflag,
                l.discipline_sequence,
                l.discipline_victimtype,
                l.discipline_weaponrelatedflag,
                l.discipline_weapontype,
                l.discipline_weapontypenotes,
                l.incidenttypecategory
            FROM
                schools                  sch
                INNER JOIN      log      l
                                ON l.schoolid = sch.school_number
                INNER JOIN      students stu
                                ON stu.dcid = l.studentid
                LEFT OUTER JOIN teachers tch
                                ON tch.dcid = l.teacherid
                LEFT OUTER JOIN gen      lt
                                ON lt.id = l.logtypeid
                                    AND lt.cat = 'logtype'
                LEFT OUTER JOIN gen      st
                                ON to_number(st.name) = l.logtypeid
                                    AND st.value = l.subtype
                                    AND st.cat = 'subtype'
            WHERE
                 l.studentid = :studentDCID
              OR :studentDCID IS NULL
            ORDER BY
                l.entry_date DESC
            ]]>
        </sql>
    </query>
</queries>