~[x:insertfile;/admin/logentries/eslogs/admin_templates.txt]

~[x:insertfile;/admin/logentries/eslogs/teacher_templates.txt]

<script type="text/javascript" src="/scripts/timeentry_widget.js"></script>
<script type="text/javascript" src="/scripts/eslogs/utils.js"></script>

<script>
    function collapsibleClick()
    {
        let checkbox = $j(this).find('input[type="checkbox"]');
        let checked = !$j(this).hasClass('expanded');

        checkbox.prop('checked', checked);
    }

    function matchAdminCheckboxChange()
    {
        let visible = !$j(this).is(':checked');

        setVisible($j(this).parent().parent().nextAll(), visible);
    }

    function setDefaultFields(portal)
    {
        let prefix = '#' + portal;
        let staticVisible = $j(prefix + 'DefType').val() === 'static';
        let dynamicVisible = $j(prefix + 'DefType').val() === 'dynamic';

        setVisible($j(prefix + 'DefStaticVal'), staticVisible);
        setVisible($j(prefix + 'DefDynamicVal'), dynamicVisible);
    }

    function defaultTypeChange()
    {
        let portal = $j(this).data('portal');

        setDefaultFields(portal);
    }

    function setValidationInputsType(portal, type)
    {
        let prefix = '#' + portal;

        if (type === 'Date')
        {
            $j(prefix + 'ValidDateVal1').next().removeClass('hide');
            $j(prefix + 'ValidDateVal2').next().removeClass('hide');
        }
        else
        {
            $j(prefix + 'ValidDateVal1').next().addClass('hide');
            $j(prefix + 'ValidDateVal2').next().addClass('hide');
        }

        if (type !== 'None')
        {
            setVisible($j('.adminValidVal'), false);
            setVisible($j(prefix + 'Valid' + type + 'Val1'), true);
            setVisible($j(prefix + 'Valid' + type + 'Val2'), true);
        }
    }

    function setValidationValue2Visible(portal)
    {
        let prefix = '#' + portal;
        let operator = $j(prefix + 'ValidOperator').val();
        let visible = operator === 'between' || operator === 'notbetween';

        setVisible($j(prefix + 'ValidSpan2'), visible);
    }

    function setValidationFields(portal)
    {
        let prefix = '#' + portal;
        let validationType = $j(prefix + 'ValidType').val();
        let inputTypes =
                {
                    'numeric': 'Number',
                    'date':    'Date',
                    'time':    'Time',
                    'email':   'Text',
                    'phone':   'Text',
                    'regex':   'Text'
                };

        if (validationType === 'none')
        {
            setVisible($j(prefix + 'ValidSpan1'), false);
            setVisible($j(prefix + 'ValidSpan2'), false);
            setValidationInputsType(portal, 'None');
        }
        else
        {
            setVisible($j(prefix + 'ValidSpan1'), true);
            setValidationValue2Visible(portal);

            setValidationInputsType(portal, inputTypes[validationType]);
        }
    }

    function validationTypeChange()
    {
        let portal = $j(this).data('portal');

        setValidationFields(portal);
    }

    function validationOperatorChange()
    {
        let portal = $j(this).data('portal');

        setValidationValue2Visible(portal);
    }

    function validationTimeValueChange()
    {
        let timeValue = $j(this);
        let target = timeValue.parent().next();

        copyTimeValue(target, timeValue);
    }

    function setupEventHandlers()
    {
        $j('.toggle').on('click', collapsibleClick);
        $j('.matchAdmin').on('change', matchAdminCheckboxChange);
        $j('.defaultType').on('change', defaultTypeChange);
        $j('.validationType').on('change', validationTypeChange);
        $j('.validationOperator').on('change', validationOperatorChange);
        $j('.validTimeVal').on('change', validationTimeValueChange);
    }

    function addCustomPageContent()
    {
        let adminContent = $j('#adminTemplate').html();
        let teacherContent = $j('#teacherTemplate').html();
        let target = $j('.box-round table');

        target.wrap('<div id="adminOptions" class="box-round"></div>');

        let adminOptions = $j('#adminOptions');

        adminOptions.prepend('<h2>Admin Portal</h2>');
        adminOptions.append(adminContent);
        adminOptions.after(teacherContent);
    }

    function setupFields()
    {
        $j('.toggle')
            .each(function ()
                  {
                      let checkbox = $j(this).find('input[type="checkbox"]');

                      if (checkbox.is(':checked'))
                      {
                          $j(this).removeClass('collapsed')
                                  .addClass('expanded');
                          $j(this).attr('aria-expanded', 'true');
                          setVisible($j(this).next(), true);
                      }
                  });

        setDefaultFields('admin');
        setDefaultFields('teacher');
        setValidationFields('admin');
    }

    (function ()
    {
        addCustomPageContent();
        setupFields();
        setupEventHandlers();
    })();

    $j(function ()
       {
           $j('.validTimeVal')
               .each(function ()
                     {
                         let timeValue = $j(this);
                         let source = timeValue.parent().next();

                         copyTimeValue(source, timeValue);
                     });
       });
</script>