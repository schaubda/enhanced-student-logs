~[x:insertfile;/admin/logentries/eslogs/option_templates.txt]

~[x:insertfile;/admin/logentries/eslogs/admin_templates.txt]

~[x:insertfile;/admin/logentries/eslogs/teacher_templates.txt]

<script>
    const NUMERIC_OPERATORS =
              {
                  'greater':        'Greater than',
                  'greaterorequal': 'Greater than or equal to',
                  'less':           'Less than',
                  'lessorequal':    'Less than or equal to',
                  'equal':          'Equal to',
                  'notequal':       'Not equal to',
                  'between':        'Between',
                  'notbetween':     'Not between'
              };

    const DATE_TIME_OPERATORS =
              {
                  'greater':        'After',
                  'greaterorequal': 'On or after',
                  'less':           'Before',
                  'lessorequal':    'On or before',
                  'equal':          'On',
                  'notequal':       'Not on',
                  'between':        'Between',
                  'notbetween':     'Not between'
              };

    function setHide(jQueryElement, hide)
    {
        if (hide)
        {
            if (!jQueryElement.hasClass('hide'))
            {
                jQueryElement.addClass('hide');
            }

            jQueryElement.prop('disabled', true);
        }
        else
        {
            if (jQueryElement.hasClass('hide'))
            {
                jQueryElement.removeClass('hide');
            }

            jQueryElement.prop('disabled', false);
        }
    }

    function collapsibleClick()
    {
        let checkbox = $j(this).find('input[type="checkbox"]');

        if ($j(this).hasClass('expanded'))
        {
            checkbox.prop('checked', false);
        }
        else
        {
            checkbox.prop('checked', true);
        }
    }

    function matchAdminCheckboxChange()
    {
        if ($j(this).is(':checked'))
        {
            setHide($j(this).parent().parent().nextAll(), true);
        }
        else
        {
            setHide($j(this).parent().parent().nextAll(), false);
        }
    }

    function setDefaultFields(portal)
    {
        let prefix = '#' + portal;

        switch ($j(prefix + 'DefaultType').val())
        {
            case 'none':
                setHide($j(prefix + 'DefStaticValue'), true);
                setHide($j(prefix + 'DefDynamicValue'), true);
                break;

            case 'static':
                setHide($j(prefix + 'DefStaticValue'), false);
                setHide($j(prefix + 'DefDynamicValue'), true);
                break;

            case 'dynamic':
                setHide($j(prefix + 'DefStaticValue'), true);
                setHide($j(prefix + 'DefDynamicValue'), false);
                break;
        }
    }

    function defaultTypeChange()
    {
        let defaultType = $j(this);
        let portal = defaultType.data('portal');

        setDefaultFields(portal);
    }

    function setValidationFields(portal)
    {
        let prefix = '#' + portal;
        let validationType = $j(prefix + 'ValidType').val();

        switch (validationType)
        {
            case 'none':
                setHide($j(prefix + 'ValidSpan1'), true);
                setHide($j(prefix + 'ValidSpan2'), true);
                break;

            case 'numeric':
                setHide($j(prefix + 'ValidSpan1'), false);
                setValidationValue2Visible(portal);
                $j(prefix + 'ValidValue1').removeClass()
                $j(prefix + 'ValidValue2').removeClass()
                initBehaviors();
                $j(prefix + 'ValidValue1').addClass('psNumWidget');
                $j(prefix + 'ValidValue2').addClass('psNumWidget');
                initBehaviors();
                break;

            case 'date':
                setHide($j(prefix + 'ValidSpan1'), false);
                setValidationValue2Visible(portal);
                $j(prefix + 'ValidValue1').removeClass();
                $j(prefix + 'ValidValue2').removeClass();
                initBehaviors();
                $j(prefix + 'ValidValue1').addClass('psDateWidget');
                $j(prefix + 'ValidValue2').addClass('psDateWidget');
                initBehaviors();
                break;

            case 'time':
                setHide($j(prefix + 'ValidSpan1'), false);
                setValidationValue2Visible(portal);
                $j(prefix + 'ValidValue1').removeClass();
                $j(prefix + 'ValidValue2').removeClass();
                initBehaviors();
                $j(prefix + 'ValidValue1').addClass('timeEntry');
                $j(prefix + 'ValidValue2').addClass('timeEntry');
                initBehaviors();
                break;

            case 'email':
            case 'phone':
            case 'regex':
                setHide($j(prefix + 'ValidSpan1'), false);
                setValidationValue2Visible(portal);
                $j(prefix + 'ValidValue1').removeClass();
                $j(prefix + 'ValidValue2').removeClass();
                initBehaviors();
                break;
        }
    }

    function validationTypeChange()
    {
        let validationType = $j(this);
        let portal = validationType.data('portal');

        setValidationFields(portal);
    }

    function setValidationValue2Visible(portal)
    {
        let prefix = '#' + portal;
        let operator = $j(prefix + 'ValidOperator').val();

        if (operator === 'greater' ||
            operator === 'greaterorequal' ||
            operator === 'less' ||
            operator === 'lessorequal' ||
            operator === 'equal' ||
            operator === 'notequal')
        {
            setHide($j(prefix + 'ValidSpan2'), true);
        }
        else if (operator === 'between' ||
                 operator === 'notbetween')
        {
            setHide($j(prefix + 'ValidSpan2'), false);
        }
    }

    function validationOperatorChange()
    {
        let operator = $j(this);
        let portal = operator.data('portal');

        setValidationValue2Visible(portal);
    }

    function setupEventHandlers()
    {
        $j('.toggle').on('click', collapsibleClick);
        $j('.matchAdmin').on('change', matchAdminCheckboxChange);
        $j('.defaultType').on('change', defaultTypeChange);
        $j('.validationType').on('change', validationTypeChange);
        $j('.validationOperator').on('change', validationOperatorChange);
    }

    function addCustomPageContent()
    {
        let adminContent = $j('#adminTemplate').html();
        let teacherContent = $j('#teacherTemplate').html();
        let target = $j('.box-round table');

        target.wrap('<div id="adminOptions" class="box-round"></div>');

        let adminOptions = $j('#adminOptions');

        adminOptions.prepend('<h2>Admin Portal</h2>');
        adminOptions.append(adminContent);
        adminOptions.after(teacherContent);
    }

    function setupFields()
    {
        $j('.toggle')
            .each(function ()
                  {
                      let checkbox = $j(this).find('input[type="checkbox"]');

                      if (checkbox.is(':checked'))
                      {
                          $j(this).removeClass('collapsed')
                                  .addClass('expanded');
                          $j(this).attr('aria-expanded', 'true');
                          setHide($j(this).next(), false);
                      }
                  });

        setDefaultFields('admin');
        setDefaultFields('teacher');
        setValidationFields('admin');
    }

    (function ()
    {
        addCustomPageContent();
        setupFields();
        setupEventHandlers();
    })();
</script>